本指南旨在帮助用户使用腾讯云 CMQ 高效处理消息并降低成本。

## 1. 处理消息

- 要确保有足够的时间处理消息，请使用适当的策略：
 - 如果知道（或者可以合理地估计）处理消息所需的时间，则将消息的可见性超时 延长至处理消息所需的最长时间并删除消息。有关更多信息，请参阅可见性超时的常见建议和更改消息的可见性超时。
 - 如果不知道处理消息所需的时间，请指定初始可见性超时（例如 2 分钟）和时段（在此时段后，您可以检查是否已处理消息）（例如 1 分钟）。如果消息未得到处理，请延长可见性超时（例如，延长至 1 分钟）。

要处理无法临时处理的所有消息，请使用适当的策略：
- 如果您已使用 AWS 开发工具包，则可任意使用自动重试和回退 逻辑。有关更多信息，请参阅 AWS 中的错误重试和指数回退。
如果您未使用 AWS 开发工具包功能进行重试和回退，要在未收到来自 Amazon SQS 的任何消息、出现超时或收到来自 Amazon SQS 的错误消息后重试 ReceiveMessage 操作，请允许重新调用操作前的暂停时间（例如 200 毫秒）。对于将产生相同结果的 ReceiveMessage 的后续使用，允许更长的暂停时间（例如 400 毫秒）等。

## 2. 降低成本

要降低成本，可批处理您的消息操作：
- 要发送、接收和删除消息，并通过单一操作更改多条消息的消息可见性超时，请使用 Amazon SQS 批处理 API 操作。
- 要将客户端缓冲和请求批处理合并，请将长轮询与 AWS SDK for Java 附带的缓冲的异步客户端结合使用。
- 要利用附加的潜在成本降低或几乎瞬时的响应，请使用适当的轮询模式：
 - 长轮询使您能够在消息可用后立即从 Amazon SQS 队列中检索消息。
要降低 Amazon SQS 的使用成本并减少空队列的空接收次数（响应不返回任何消息的 ReceiveMessage 操作），请启用长轮询。有关更多信息，请参阅 Amazon SQS 长轮询。
要提高轮询具有多次接收的多个线程的效率，请减少线程数。
在大多数情况下，长轮询优于短轮询。
 - 短轮询会立即返回消息，即使轮询的 Amazon SQS 队列为空。
要满足应立即响应 ReceiveMessage 请求的应用程序的要求，请使用短轮询。
短轮询的计费与长轮询相同。